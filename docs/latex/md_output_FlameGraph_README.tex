Main Website\+: \href{http://www.brendangregg.com/flamegraphs.html}{\texttt{ http\+://www.\+brendangregg.\+com/flamegraphs.\+html}}

Example (click to zoom)\+:

\href{http://www.brendangregg.com/FlameGraphs/cpu-bash-flamegraph.svg}{\texttt{ }}

Click a box to zoom the Flame Graph to this stack frame only. To search and highlight all stack frames matching a regular expression, click the {\itshape search} button in the upper right corner or press Ctrl-\/F. By default, search is case sensitive, but this can be toggled by pressing Ctrl-\/I or by clicking the {\itshape ic} button in the upper right corner.

Other sites\+:
\begin{DoxyItemize}
\item The Flame Graph article in ACMQ and CACM\+: \href{http://queue.acm.org/detail.cfm?id=2927301}{\texttt{ http\+://queue.\+acm.\+org/detail.\+cfm?id=2927301}} \href{http://cacm.acm.org/magazines/2016/6/202665-the-flame-graph/abstract}{\texttt{ http\+://cacm.\+acm.\+org/magazines/2016/6/202665-\/the-\/flame-\/graph/abstract}}
\item CPU profiling using Linux perf\+\_\+events, DTrace, System\+Tap, or ktap\+: \href{http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html}{\texttt{ http\+://www.\+brendangregg.\+com/\+Flame\+Graphs/cpuflamegraphs.\+html}}
\item CPU profiling using XCode Instruments\+: \href{http://schani.wordpress.com/2012/11/16/flame-graphs-for-instruments/}{\texttt{ http\+://schani.\+wordpress.\+com/2012/11/16/flame-\/graphs-\/for-\/instruments/}} ~\newline

\item CPU profiling using Xperf.\+exe\+: \href{http://randomascii.wordpress.com/2013/03/26/summarizing-xperf-cpu-usage-with-flame-graphs/}{\texttt{ http\+://randomascii.\+wordpress.\+com/2013/03/26/summarizing-\/xperf-\/cpu-\/usage-\/with-\/flame-\/graphs/}} ~\newline

\item Memory profiling\+: \href{http://www.brendangregg.com/FlameGraphs/memoryflamegraphs.html}{\texttt{ http\+://www.\+brendangregg.\+com/\+Flame\+Graphs/memoryflamegraphs.\+html}} ~\newline

\item Other examples, updates, and news\+: \href{http://www.brendangregg.com/flamegraphs.html\#Updates}{\texttt{ http\+://www.\+brendangregg.\+com/flamegraphs.\+html\#\+Updates}}
\end{DoxyItemize}

Flame graphs can be created in three steps\+:


\begin{DoxyEnumerate}
\item Capture stacks
\item Fold stacks
\item flamegraph.\+pl
\end{DoxyEnumerate}\hypertarget{md_output_FlameGraph_README_autotoc_md420}{}\doxysection{1\textbackslash{}. Capture stacks}\label{md_output_FlameGraph_README_autotoc_md420}
Stack samples can be captured using Linux perf\+\_\+events, Free\+BSD pmcstat (hwpmc), DTrace, System\+Tap, and many other profilers. See the stackcollapse-\/$\ast$ converters.\hypertarget{md_output_FlameGraph_README_autotoc_md421}{}\doxysubsubsection{Linux perf\+\_\+events}\label{md_output_FlameGraph_README_autotoc_md421}
Using Linux perf\+\_\+events (aka \char`\"{}perf\char`\"{}) to capture 60 seconds of 99 Hertz stack samples, both user-\/ and kernel-\/level stacks, all processes\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# perf record -\/F 99 -\/a -\/g -\/-\/ sleep 60}
\DoxyCodeLine{\# perf script > out.perf}

\end{DoxyCode}


Now only capturing PID 181\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# perf record -\/F 99 -\/p 181 -\/g -\/-\/ sleep 60}
\DoxyCodeLine{\# perf script > out.perf}

\end{DoxyCode}
\hypertarget{md_output_FlameGraph_README_autotoc_md422}{}\doxysubsubsection{DTrace}\label{md_output_FlameGraph_README_autotoc_md422}
Using DTrace to capture 60 seconds of kernel stacks at 997 Hertz\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# dtrace -\/x stackframes=100 -\/n 'profile-\/997 /arg0/ \{ @[stack()] = count(); \} tick-\/60s \{ exit(0); \}' -\/o out.kern\_stacks}

\end{DoxyCode}


Using DTrace to capture 60 seconds of user-\/level stacks for PID 12345 at 97 Hertz\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# dtrace -\/x ustackframes=100 -\/n 'profile-\/97 /pid == 12345 \&\& arg1/ \{ @[ustack()] = count(); \} tick-\/60s \{ exit(0); \}' -\/o out.user\_stacks}

\end{DoxyCode}


60 seconds of user-\/level stacks, including time spent in-\/kernel, for PID 12345 at 97 Hertz\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\# dtrace -\/x ustackframes=100 -\/n 'profile-\/97 /pid == 12345/ \{ @[ustack()] = count(); \} tick-\/60s \{ exit(0); \}' -\/o out.user\_stacks}

\end{DoxyCode}


Switch {\ttfamily ustack()} for {\ttfamily jstack()} if the application has a ustack helper to include translated frames (eg, node.\+js frames; see\+: \href{http://dtrace.org/blogs/dap/2012/01/05/where-does-your-node-program-spend-its-time/}{\texttt{ http\+://dtrace.\+org/blogs/dap/2012/01/05/where-\/does-\/your-\/node-\/program-\/spend-\/its-\/time/}}). The rate for user-\/level stack collection is deliberately slower than kernel, which is especially important when using {\ttfamily jstack()} as it performs additional work to translate frames.\hypertarget{md_output_FlameGraph_README_autotoc_md423}{}\doxysection{2\textbackslash{}. Fold stacks}\label{md_output_FlameGraph_README_autotoc_md423}
Use the stackcollapse programs to fold stack samples into single lines. The programs provided are\+:


\begin{DoxyItemize}
\item {\ttfamily stackcollapse.\+pl}\+: for DTrace stacks
\item {\ttfamily stackcollapse-\/perf.\+pl}\+: for Linux perf\+\_\+events \char`\"{}perf script\char`\"{} output
\item {\ttfamily stackcollapse-\/pmc.\+pl}\+: for Free\+BSD pmcstat -\/G stacks
\item {\ttfamily stackcollapse-\/stap.\+pl}\+: for System\+Tap stacks
\item {\ttfamily stackcollapse-\/instruments.\+pl}\+: for XCode Instruments
\item {\ttfamily stackcollapse-\/vtune.\+pl}\+: for Intel VTune profiles
\item {\ttfamily stackcollapse-\/ljp.\+awk}\+: for Lightweight Java Profiler
\item {\ttfamily stackcollapse-\/jstack.\+pl}\+: for Java jstack(1) output
\item {\ttfamily stackcollapse-\/gdb.\+pl}\+: for gdb(1) stacks
\item {\ttfamily stackcollapse-\/go.\+pl}\+: for Golang pprof stacks
\item {\ttfamily stackcollapse-\/vsprof.\+pl}\+: for Microsoft Visual Studio profiles
\item {\ttfamily stackcollapse-\/wcp.\+pl}\+: for wall\+Clock\+Profiler output
\end{DoxyItemize}

Usage example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{For perf\_events:}
\DoxyCodeLine{\$ ./stackcollapse-\/perf.pl out.perf > out.folded}
\DoxyCodeLine{}
\DoxyCodeLine{For DTrace:}
\DoxyCodeLine{\$ ./stackcollapse.pl out.kern\_stacks > out.kern\_folded}

\end{DoxyCode}


The output looks like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs 1401}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close 5}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf 85}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf;c2audit`audit\_closef 26}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf;c2audit`audit\_setf 5}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf;genunix`audit\_getstate 6}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf;genunix`audit\_unfalloc 2}
\DoxyCodeLine{unix`\_sys\_sysenter\_post\_swapgs;genunix`close;genunix`closeandsetf;genunix`closef 48}
\DoxyCodeLine{[...]}

\end{DoxyCode}
\hypertarget{md_output_FlameGraph_README_autotoc_md424}{}\doxysection{3\textbackslash{}. flamegraph.\+pl}\label{md_output_FlameGraph_README_autotoc_md424}
Use flamegraph.\+pl to render a SVG.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./flamegraph.pl out.kern\_folded > kernel.svg}

\end{DoxyCode}


An advantage of having the folded input file (and why this is separate to flamegraph.\+pl) is that you can use grep for functions of interest. Eg\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ grep cpuid out.kern\_folded | ./flamegraph.pl > cpuid.svg}

\end{DoxyCode}
\hypertarget{md_output_FlameGraph_README_autotoc_md425}{}\doxysection{Provided Examples}\label{md_output_FlameGraph_README_autotoc_md425}
\hypertarget{md_output_FlameGraph_README_autotoc_md426}{}\doxysubsubsection{Linux perf\+\_\+events}\label{md_output_FlameGraph_README_autotoc_md426}
An example output from Linux \char`\"{}perf script\char`\"{} is included, gzip\textquotesingle{}d, as example-\/perf-\/stacks.\+txt.\+gz. The resulting flame graph is example-\/perf.\+svg\+:

\href{http://www.brendangregg.com/FlameGraphs/example-perf.svg}{\texttt{ }}

You can create this using\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ gunzip -\/c example-\/perf-\/stacks.txt.gz | ./stackcollapse-\/perf.pl -\/-\/all | ./flamegraph.pl -\/-\/color=java -\/-\/hash > example-\/perf.svg}

\end{DoxyCode}


This shows my typical workflow\+: I\textquotesingle{}ll gzip profiles on the target, then copy them to my laptop for analysis. Since I have hundreds of profiles, I leave them gzip\textquotesingle{}d!

Since this profile included Java, I used the flamegraph.\+pl --color=java palette. I\textquotesingle{}ve also used stackcollapse-\/perf.\+pl --all, which includes all annotations that help flamegraph.\+pl use separate colors for kernel and user level code. The resulting flame graph uses\+: green == Java, yellow == C++, red == user-\/mode native, orange == kernel.

This profile was from an analysis of vert.\+x performance. The benchmark client, wrk, is also visible in the flame graph.\hypertarget{md_output_FlameGraph_README_autotoc_md427}{}\doxysubsubsection{DTrace}\label{md_output_FlameGraph_README_autotoc_md427}
An example output from DTrace is also included, example-\/dtrace-\/stacks.\+txt, and the resulting flame graph, example-\/dtrace.\+svg\+:

\href{http://www.brendangregg.com/FlameGraphs/example-dtrace.svg}{\texttt{ }}

You can generate this using\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./stackcollapse.pl example-\/stacks.txt | ./flamegraph.pl > example.svg}

\end{DoxyCode}


This was from a particular performance investigation\+: the Flame Graph identified that CPU time was spent in the lofs module, and quantified that time.\hypertarget{md_output_FlameGraph_README_autotoc_md428}{}\doxysection{Options}\label{md_output_FlameGraph_README_autotoc_md428}
See the USAGE message (--help) for options\+:

USAGE\+: ./flamegraph.pl \mbox{[}options\mbox{]} infile $>$ outfile.\+svg \begin{DoxyVerb}--title TEXT     # change title text
--subtitle TEXT  # second level title (optional)
--width NUM      # width of image (default 1200)
--height NUM     # height of each frame (default 16)
--minwidth NUM   # omit smaller functions. In pixels or use "%" for 
                 # percentage of time (default 0.1 pixels)
--fonttype FONT  # font type (default "Verdana")
--fontsize NUM   # font size (default 12)
--countname TEXT # count type label (default "samples")
--nametype TEXT  # name type label (default "Function:")
--colors PALETTE # set color palette. choices are: hot (default), mem,
                 # io, wakeup, chain, java, js, perl, red, green, blue,
                 # aqua, yellow, purple, orange
--bgcolors COLOR # set background colors. gradient choices are yellow
                 # (default), blue, green, grey; flat colors use "#rrggbb"
--hash           # colors are keyed by function name hash
--cp             # use consistent palette (palette.map)
--reverse        # generate stack-reversed flame graph
--inverted       # icicle graph
--flamechart     # produce a flame chart (sort by time, do not merge stacks)
--negate         # switch differential hues (blue<->red)
--notes TEXT     # add notes comment in SVG (for debugging)
--help           # this message

eg,
./flamegraph.pl --title="Flame Graph: malloc()" trace.txt > graph.svg
\end{DoxyVerb}
 As suggested in the example, flame graphs can process traces of any event, such as malloc()s, provided stack traces are gathered.\hypertarget{md_output_FlameGraph_README_autotoc_md429}{}\doxysection{Consistent Palette}\label{md_output_FlameGraph_README_autotoc_md429}
If you use the {\ttfamily -\/-\/cp} option, it will use the \$colors selection and randomly generate the palette like normal. Any future flamegraphs created using the {\ttfamily -\/-\/cp} option will use the same palette map. Any new symbols from future flamegraphs will have their colors randomly generated using the \$colors selection.

If you don\textquotesingle{}t like the palette, just delete the palette.\+map file.

This allows your to change your colorscheme between flamegraphs to make the differences REALLY stand out.

Example\+:

Say we have 2 captures, one with a problem, and one when it was working (whatever \char`\"{}it\char`\"{} is)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cat working.folded | ./flamegraph.pl -\/-\/cp > working.svg}
\DoxyCodeLine{\# this generates a palette.map, as per the normal random generated look.}
\DoxyCodeLine{}
\DoxyCodeLine{cat broken.folded | ./flamegraph.pl -\/-\/cp -\/-\/colors mem > broken.svg}
\DoxyCodeLine{\# this svg will use the same palette.map for the same events, but a very}
\DoxyCodeLine{\# different colorscheme for any new events.}

\end{DoxyCode}


Take a look at the demo directory for an example\+:

palette-\/example-\/working.\+svg ~\newline
 palette-\/example-\/broken.\+svg 